<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>About The CANADA List | Why We Made This Site</title>
  <meta name="description" content="Learn how The CANADA List helps Canadians find products that support local jobs and businesses. See what inspired the project.">
  <meta name="google-site-verification" content="tnvrwqMttr-LnJRmyhdmeQ8o3zhnBJTXH_tqEfqud1U" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">

  <meta property="og:title" content="The CANADA List – Find Canadian-Made Products" />
  <meta property="og:description" content="Search, sort, and filter to find products that are truly Canadian-owned, made, and sourced." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://thecanadalist.ca/" />
  <meta property="og:image" content="https://thecanadalist.ca/images/The Canada List Banner.jpg" />

  <link rel="canonical" href="https://thecanadalist.ca/">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The CANADA List – Find Canadian-Made Products">
  <meta name="twitter:description" content="Search, sort, and filter products that are truly Canadian-owned, made, and sourced.">
  <meta name="twitter:image" content="https://thecanadalist.ca/images/The Canada List Banner.jpg">
  <meta name="twitter:site" content="@TheCanadaList">

  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z0C2RC3LEH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z0C2RC3LEH');
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const productTypeFilter = document.getElementById("productTypeFilter");

    if (searchInput) {
      searchInput.addEventListener("input", function () {
        gtag('event', 'search_input', {
          'event_category': 'Interaction',
          'event_label': searchInput.value
        });
      });
    }

    if (productTypeFilter) {
      productTypeFilter.addEventListener("change", function () {
        gtag('event', 'product_filter_change', {
          'event_category': 'Interaction',
          'event_label': productTypeFilter.value
        });
      });
    }
  });
</script>

</head>

<script>
  (function() {
    if (localStorage.getItem("ctaDismissed") === "true") {
      const style = document.createElement("style");
      style.innerHTML = `
        .cta-bar { display: none !important; }
        body { padding-top: 85px !important; }
        .top-nav { top: 0 !important; }
      `;
      document.head.appendChild(style);
    }
  })();
</script>

 <!-- Call to Action Bar -->
 <div class="cta-bar" id="ctaBar">
  <div class="cta-content">
    <span>Stay apprised of Canadian product info via our newsletter:</span>
    <form action="https://formsubmit.co/newsletter@thecanadalist.ca" method="POST" class="cta-form">
      <input type="email" name="email" placeholder="Enter your email" required />
      <button type="submit">Subscribe</button>
      <input type="hidden" name="_subject" value="New Newsletter Signup">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_autoresponse" value="Thanks for signing up for updates from The CANADA List!">
    </form>
    <button id="closeCTA" aria-label="Close CTA Bar">✕</button>
  </div>
</div>

<nav class="top-nav">
  <button class="menu-toggle" onclick="toggleMenu()">☰</button>
  <div class="nav-container full-width-bar">
    <div class="nav-left-spacer"></div>

    <ul class="nav-links" id="mobileMenu">
      <li><a href="index.html">The List</a></li>
      <li><a href="submit.html">Submit a Product</a></li>
      <li><a href="support.html">Support the Site</a></li>
      <li><a href="Blogs-homepage.html" class="highlight">Blog</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>

    <div class="nav-right-tip">
      <a href="tipline.html">New: False Flag Tip Line</a>
    </div>
  </div>
</nav>

<body>
  <header id="siteHeader" style="position: relative;">
 
    <!-- Banner content -->
    <img src="https://upload.wikimedia.org/wikipedia/en/c/cf/Flag_of_Canada.svg" alt="Canadian flag" class="flag">
    <h1><span>The</span> <span style="color: #cc0000">CANADA</span> <span>List</span></h1>
    <div class="subtitle">Know what you're buying. Support what matters.</div>

    <div class="header-links">
      <a href="about.html">Why this site exists</a>
      <a href="scoring.html">How the CANADA scores are derived</a>
    </div>
  </header>  



  <div id="controls">
    <div>
      <input type="text" id="searchInput" placeholder="Search by keyword...">
      <select id="productTypeFilter">
        <option value="">All Types</option>
      </select>
    </div>
    <div id="filtersContainer">
      <label><input type="checkbox" id="ownershipCanada"> Filter Canadian Ownership only</label>
      <label><input type="checkbox" id="manufacturingCanada"> Filter Canadian Manufacturing only</label>
    </div>
  </div>
  <div id="selectedCategoryDisplay"></div>

  <table id="productTable">
    <thead>
      <tr>
        <th onclick="sortTable('Product Name')" id="th-Product Name">Product Name</th>
        <th>Parent Company</th>
        <th onclick="sortTable('CANADIAN Score (out of 10)')" id="th-CANADIAN Score (out of 10)">
          The <span class="highlight">CANADA</span> Score
        </th>
        <th>Product Category</th>
        <th>Ownership</th>
        <th>Manufacturing</th>
        <th>Notes</th>
      </tr>
    </thead>
    
    
    <tbody id="tableBody">
      <tr id="emptyMessageRow" style="display:none;">
        <td colspan="7" style="text-align:center; font-style:italic; padding:20px;">
          No products found — try broadening your search.
        </td>
      </tr>
    </tbody>
  </table>

  <div id="paginationControls">
    <span id="prevLink" class="disabled" onclick="goToPrevPage()">Previous Page</span>
    <span id="paginationInfo" style="margin-bottom: 8px; font-size: 16px;"></span>
    <span id="nextLink" onclick="goToNextPage()">Next Page</span>
  </div>

  <script src="./categoriesData.js"></script>

  <script>
    /////////////////////////////////////////////////
    // We'll store all products in memory, but only
    // do minimal DOM updates to avoid full rebuild.
    /////////////////////////////////////////////////

    let products = [];
    let selectedCategory = "";

    // We'll keep a global array of filtered data
    let filteredProducts = [];

    // We'll keep track of the last known filter state
    let lastSearchValue = null;
    let lastTypeFilter = null;
    let lastOwnershipCanada = false;
    let lastManufacturingCanada = false;

    let currentSortField = '';
    let sortAscending = true;
    let currentPage = 1;
    const pageSize = 50;

    // Debounce for the search input
    let searchDebounceTimer = null;

    // We'll store references to the <tr> elements we create.
    let currentRowMap = new Map();

    // Single onload
    window.onload = async function() {
      await fetchProducts();
      console.log("categoriesData?", categoriesData);
      populateFilterOptions();
    };

    // Fetch TheCanadaList.json
    async function fetchProducts() {
  try {
    const response = await fetch('./TheCanadaList.json');
    products = await response.json();
    // Set default sort: Score column in descending order
    currentSortField = "CANADIAN Score (out of 10)";
    sortAscending = false;
    doFullFilter();
  } catch (error) {
    console.error("Error fetching products:", error);
  }
}

    // Debounce for search input
    document.getElementById("searchInput").addEventListener("input", () => {
      currentPage = 1;
      clearTimeout(searchDebounceTimer);
      searchDebounceTimer = setTimeout(() => {
        doFullFilter();
      }, 300);
    });

    document.getElementById("productTypeFilter").addEventListener("change", () => {
      currentPage = 1;
      doFullFilter();
    });

    document.getElementById("ownershipCanada").addEventListener("change", () => {
      currentPage = 1;
      doFullFilter();
    });

    document.getElementById("manufacturingCanada").addEventListener("change", () => {
      currentPage = 1;
      doFullFilter();
    });

    function doFullFilter() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const typeFilter = document.getElementById("productTypeFilter").value;
      const ownershipCanada = document.getElementById("ownershipCanada").checked;
      const manufacturingCanada = document.getElementById("manufacturingCanada").checked;

      // If filter conditions didn't change, skip re-filter.
      if (
        searchValue === lastSearchValue &&
        typeFilter === lastTypeFilter &&
        ownershipCanada === lastOwnershipCanada &&
        manufacturingCanada === lastManufacturingCanada &&
        currentSortField
      ) {
        doSort();
        updatePaginationAndRender();
        return;
      }

      lastSearchValue = searchValue;
      lastTypeFilter = typeFilter;
      lastOwnershipCanada = ownershipCanada;
      lastManufacturingCanada = manufacturingCanada;

      filteredProducts = products.filter(product => {
        const searchFields = [
          product["Product Name"],
          product["Product Category"],
          product["Ownership (Company)"],
          product["Ownership (Country)"],
          product["Manufacturing (Countries)"],
          product["Notes"]
        ];
        const matchesSearch = searchFields.some(field =>
          String(field || "").toLowerCase().includes(searchValue)
        );
        const matchesType =
          !typeFilter ||
          product["Product Category"]?.toLowerCase().trim() === typeFilter.toLowerCase().trim();
        const matchesOwnership =
          !ownershipCanada || product["Ownership (Country)"] === "Canada";
        const matchesManufacturing =
          !manufacturingCanada || product["Manufacturing (Countries)"] === "Canada";
        return matchesSearch && matchesType && matchesOwnership && matchesManufacturing;
      });

      doSort();
      updatePaginationAndRender();
    }

    function doSort() {
  if (!currentSortField) return;
  filteredProducts.sort((a, b) => {
    let aVal = a[currentSortField];
    let bVal = b[currentSortField];
    // If sorting by Canada Score, force numeric conversion.
    if (currentSortField === "CANADIAN Score (out of 10)") {
      aVal = parseFloat(String(aVal).trim());
      bVal = parseFloat(String(bVal).trim());
      if (isNaN(aVal)) aVal = 0;
      if (isNaN(bVal)) bVal = 0;
    }
    if (typeof aVal === "number" && typeof bVal === "number") {
      return sortAscending ? aVal - bVal : bVal - aVal;
    } else {
      return sortAscending
        ? String(aVal).localeCompare(String(bVal))
        : String(bVal).localeCompare(String(aVal));
    }
  });
}


    function updatePaginationAndRender() {
      const totalPages = Math.ceil(filteredProducts.length / pageSize) || 1;
      if (currentPage > totalPages) currentPage = totalPages;
      if (currentPage < 1) currentPage = 1;

      const pageProducts = filteredProducts.slice(
        (currentPage - 1) * pageSize,
        currentPage * pageSize
      );
      patchTable(pageProducts);

      document.getElementById("emptyMessageRow").style.display =
        filteredProducts.length === 0 ? "table-row" : "none";
      renderPaginationControls(totalPages);
    }

    function patchTable(newPageProducts) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = ""; // clear the table body
  currentRowMap.clear(); // clear the map so the new order is built fresh
  newPageProducts.forEach(product => {
    const newRow = createRow(product);
    tbody.appendChild(newRow);
    currentRowMap.set(product.id, newRow);
  });
}


    function createRow(product) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>
          ${product["Product Name"]}
          ${
            product["Ownership (Country)"] === "Canada" &&
            product["Manufacturing (Countries)"] === "Canada"
              ? '<img src="https://upload.wikimedia.org/wikipedia/en/c/cf/Flag_of_Canada.svg" alt="Canadian flag" style="height: 16px; vertical-align: middle; margin-left: 6px;">'
              : ""
          }
        </td>
        <td>${product["Ownership (Company)"]}</td>
        <td>${product["CANADIAN Score (out of 10)"]}</td>
        <td>${product["Product Category"]}</td>
        <td>${product["Ownership (Country)"]}</td>
        <td>${product["Manufacturing (Countries)"]}</td>
        <td>${product["Notes"]}</td>
      `;
      return row;
    }

    function renderPaginationControls(totalPages) {
      const info = document.getElementById("paginationInfo");
      info.textContent = `Page ${currentPage} of ${totalPages}`;

      const nextLink = document.getElementById("nextLink");
      nextLink.classList.toggle("disabled", currentPage >= totalPages);

      const prevLink = document.getElementById("prevLink");
      prevLink.classList.toggle("disabled", currentPage <= 1);
    }

    function goToNextPage() {
      const totalPages = Math.ceil(filteredProducts.length / pageSize) || 1;
      if (currentPage < totalPages) {
        currentPage++;
        updatePaginationAndRender();
      }
    }

    function goToPrevPage() {
      if (currentPage > 1) {
        currentPage--;
        updatePaginationAndRender();
      }
    }

    function sortTable(sortBy = null) {
      if (!sortBy) return;
      if (sortBy === currentSortField) {
        sortAscending = !sortAscending;
      } else {
        currentSortField = sortBy;
        sortAscending = true;
      }
      updateSortArrow(sortBy);
      doSort();
      updatePaginationAndRender();
    }

    function updateSortArrow(sortBy) {
      document.querySelectorAll("th").forEach((th) => {
        th.classList.remove("active-asc", "active-desc");
      });
      const th = document.getElementById(`th-${sortBy}`);
      if (th) {
        th.classList.add(sortAscending ? "active-asc" : "active-desc");
      }
    }

    function populateFilterOptions() {
      const filter = document.getElementById("productTypeFilter");
      filter.innerHTML = "";

      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = "Search by Category";
      filter.appendChild(defaultOption);

      categoriesData.forEach((category) => {
        const group = document.createElement("optgroup");
        group.label = category.label;

        if (category.subcategories && category.subcategories.length > 0) {
          category.subcategories.forEach((sub) => {
            if (sub.subcategories) {
              sub.subcategories.forEach((subsub) => {
                const option = document.createElement("option");
                option.value = subsub.label;
                option.textContent = `${sub.label} → ${subsub.label}`;
                group.appendChild(option);
              });
            } else {
              const option = document.createElement("option");
              option.value = sub.label;
              option.textContent = sub.label;
              group.appendChild(option);
            }
          });
        }
        filter.appendChild(group);
      });
    }

    function buildCategoryMenu(dataArray, parentUl) {
  dataArray.forEach((item) => {
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.href = "#";
    a.textContent = item.label;

    a.addEventListener("click", (event) => {
      event.preventDefault();
      event.stopPropagation();
      const subMenu = li.querySelector(".submenu");
      if (subMenu) {
        // Close any sibling submenus if desired
        const siblingSubMenus = li.parentNode.querySelectorAll(".submenu");
        siblingSubMenus.forEach(sm => {
          if (sm !== subMenu) {
            sm.style.display = "none";
          }
        });
        // Toggle the current submenu
        subMenu.style.display = (subMenu.style.display === "block") ? "none" : "block";
      } else {
        // No submenu means this is a leaf category: set and filter
        selectedCategory = item.label;
        document.getElementById("selectedCategoryDisplay").textContent = `Selected Category: ${item.label}`;
        doFullFilter();
      }
    });

    li.appendChild(a);

    if (item.subcategories && item.subcategories.length > 0) {
      const subUl = document.createElement("ul");
      subUl.classList.add("submenu");
      subUl.style.display = "none"; // Hide submenus by default
      buildCategoryMenu(item.subcategories, subUl);
      li.appendChild(subUl);
    }

    parentUl.appendChild(li);
  });
}


  </script>
  <footer style="text-align: center; padding: 20px; font-size: 0.8em; color: #555;">
    <a href="terms.html" style="color: #0077cc; text-decoration: none; margin-right: 15px;">
      Terms of Service
    </a>
    <a href="disclaimer.html" style="color: #0077cc; text-decoration: none;">
      Liability Statement
    </a>
  </footer>

  <script>
    function toggleMenu() {
      document.querySelector('.top-nav').classList.toggle('mobile-nav-open');
    }
  </script>
  
  <script>
    const input = document.getElementById('categorySearchInput');
    const dropdown = document.getElementById('categoryDropdown');
  
    function extractLabels(data) {
      let result = [];
      function recurse(items, parents = []) {
        for (const item of items) {
          const fullPath = [...parents, item.label];
          if (item.label) result.push({ label: item.label, path: fullPath });
          if (item.subcategories) recurse(item.subcategories, fullPath);
        }
      }
      recurse(categoriesData);
      return result;
    }
  
    function renderDropdown(matches) {
      dropdown.innerHTML = '';
  
      const grouped = {};
      for (const match of matches) {
        const [group, subgroup, ...rest] = match.path;
        const key = `${group}||${subgroup || ''}`;
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(match);
      }
  
      for (const key in grouped) {
        const [group, subgroup] = key.split('||');
        const groupEl = document.createElement('div');
        groupEl.className = 'category-group';
        groupEl.textContent = group;
        dropdown.appendChild(groupEl);
  
        if (subgroup) {
          const subEl = document.createElement('div');
          subEl.className = 'category-subgroup';
          subEl.textContent = subgroup;
          dropdown.appendChild(subEl);
        }
  
        for (const match of grouped[key]) {
          const item = document.createElement('div');
          item.className = 'category-item';
          item.textContent = match.path.join(" > ");
          item.addEventListener('click', () => {
            input.value = match.label;
            dropdown.innerHTML = '';
            selectedCategory = match.label;
            doFullFilter();
          });
          dropdown.appendChild(item);
        }
      }
    }
  
    input.addEventListener('input', () => {
      const filter = input.value.trim();
      if (filter === '') {
        dropdown.innerHTML = '';
        return;
      }
      const flatCategories = extractLabels(categoriesData);
      const matches = flatCategories.filter(cat => cat.label.toLowerCase().includes(filter.toLowerCase()));
      renderDropdown(matches);
    });
  
    document.addEventListener('click', (e) => {
      if (!document.getElementById('categorySearchContainer').contains(e.target)) {
        dropdown.innerHTML = '';
      }
    });
  </script>
  
  
  
</body>
</html>
